<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Piece of cake</title>
    {% load staticfiles %}
    <script src="{% static "visualizer/jquery.min.js" %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static "visualizer/css/bootstrap.min.css" %}">
    <script src="{% static "visualizer/js/bootstrap.js" %}"></script>
    <script type="text/javascript" src="{% static "visualizer/globalize.min.js" %}"></script>
    <script type="text/javascript" src="https://cdn3.devexpress.com/jslib/16.2.5/js/dx.all.js"></script>
<style>
    .tab-content > .tab-pane:not(.active),
.pill-content > .pill-pane:not(.active) {
    display: block;
    height: 0;
    overflow-y: hidden;
}

</style>
</head>
<body>

<ul class="nav nav-tabs">
  <li role="presentation">

      <a href="#history" aria-controls="history" role="tab" data-toggle="tab">History</a>
  </li>
  <li role="presentation" class="active">
      <a href="#statistics" aria-controls="statistics" role="tab" data-toggle="tab">Statistics per channel</a>
 </li>

  <li role="presentation" class="">
      <a href="#statisticsDay" aria-controls="statisticsDay" role="tab" data-toggle="tab">Statistics per day</a>
  </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
        <div class="container">
            <h3>{{ owner }}'s statistics</h3>

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Title</th>
                        <th>Channel</th>
                        <th>Date</th>
                        <th>Video</th>
                    </tr>
                </thead>
                <tbody>
                    {% for video in videos %}
                        <tr>
                            <th>{{ forloop.counter }}</th>
                            <th>{{ video.title }}</th>
                            <th>{{ video.channel }}</th>
                            <th>{{ video.date }}</th>
                            <th><a href="{{ video.url }}">{{ video.url }}</a></th>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="tab-pane fade active in" role="tabpanel" id="statistics" aria-labelledby="statistics-tab">
        <div class="row">
            <div class="col-lg-6">
                <div id="chart"></div>
            </div>
            <div class="col-lg-6">
                <div id="chart2"></div>

            </div>
        </div>
    </div>

    <div class="tab-pane fade" role="tabpanel" id="statisticsDay" aria-labelledby="statisticsDay-tab">
        <div class="container" id="day-charts">

        </div>
    </div>
</div>


<script>

        var dataSource = [];
        {% for video in videos %}
                dataSource.push({
                    "channel":'{{ video.channel }}',
                    "date":'{{ video.date|date:'d-m-Y' }}',
                    "counter":1,
                });
        {% endfor %}
        function getStatisticsPerChannel(dataSource){
            var res = {};
        //for each channel we're gonna calculate how many times it occurs in the videos
            for (var i=0, key, value; i<dataSource.length; i++){
                key = dataSource[i]["channel"];
                value = dataSource[i]["channel"];
                res[value] = (res[value] || 0)+1;
                }
            res1 = [];
            for (var key in res){
                res1 .push( {
                    "channel":key,
                    "counter":res[key],
                });
            }
            return res1;
        }
        res1 = getStatisticsPerChannel(dataSource);



        $('#chart').dxPieChart({
            palette: "bright",
            dataSource:res1,
            series:{
                argumentField:"channel",
                valueField:"counter",
                label: {
                    visible: true,
                    customizeText: function(arg) {
                        return " " + arg.percentText + " ";
                    }
                }
            },
            export: {
                enabled: true,
                fileName:"youtubeStatistics",
                formats:["PDF", "PNG", "JPEG"]
            },
        });

        $("#chart2").dxChart({
            rotated: true,
            dataSource: res1,
            series: {
                label: {
                    visible: true,
                    backgroundColor: "#c18e92"
                },
                color: "#79cac4",
                type: "bar",
               argumentField:"channel",
                    valueField:"counter"
            },
            title: "Opened Videos",
            argumentAxis: {
                label: {
                    customizeText: function() {
                        console.log(this);
                        return this.valueText;
                    }
                }
            },
            valueAxis: {
                label: {
                    visible: false
                }
            },
            export: {
                enabled: true,
                fileName:"youtubeStatistics",
                formats:["PDF", "PNG", "JPEG"]
            },
            legend: {
                visible: false
            },
         });

        res2 = []
        //$('#day-charts').append('<h3>Added</h3>');
        for (key in dataSource){
            res2[dataSource[key]["date"]]=[]
        }
        for (key in dataSource){
            res2[dataSource[key]["date"]].push(dataSource[key]);
        }
        var number=0;

        for (key in res2){
            number+=2;
          $('#day-charts').append('<h3>'+key+'</h3>');
           $('#day-charts').append(`<div class="row">
                                    <div class="col-lg-6">
                                        <div id="chart-${number}"></div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div id="chart-${number+1}"></div>

                                    </div></div>`);
           $(`#chart-${number}`).dxPieChart({
                palette: "bright",
                dataSource:getStatisticsPerChannel(res2[key]),
                series:{
                    argumentField:"channel",
                    valueField:"counter",
                    label: {
                        visible: true,
                        customizeText: function(arg) {
                            return " " + arg.percentText + " ";
                        }
                    }
                },
                export: {
                    enabled: true,
                    fileName:`youtubeStatistics-${key}`,
                    formats:["PDF", "PNG", "JPEG"]
                },
            });


           $(`#chart-${number+1}`).dxChart({
            rotated: true,
            dataSource: getStatisticsPerChannel(res2[key]),
            series: {
                label: {
                    visible: true,
                    backgroundColor: "#c18e92"
                },
                color: "#79cac4",
                type: "bar",
               argumentField:"channel",
                    valueField:"counter"
            },
            title: "    ",
            argumentAxis: {
                label: {
                    customizeText: function() {
                        console.log(this);
                        return this.valueText;
                    }
                }
            },
            valueAxis: {
                label: {
                    visible: false
                }
            },
            export: {
                enabled: true,
                fileName:`youtubeStatistics-${key}`,
                formats:["PDF", "PNG", "JPEG"]
            },
            legend: {
                visible: false
            },
         });


        }

</script>


</body>
</html>